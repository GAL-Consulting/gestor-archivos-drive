
    // ðŸ”‘ CONFIGURACIÃ“N
    const CLIENT_ID = "935035577743-7ds3utl0nsbat33sbt2ervnckcgeceqr.apps.googleusercontent.com"; // "TU_CLIENT_ID.apps.googleusercontent.com";
    const SHEET_ID = "1D8QeHDNR2bp8Ylfft-AyGTjyNbk_LLF8b6_LwvqBMqY"; //"TU_SHEET_ID";
    const SCOPES = "https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/spreadsheets";

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestor Documental</title>
  <link rel="stylesheet" href="style.css">

  <!-- Google API y Google Identity Services -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>Gestor Documental</h1>

  <!-- BotÃ³n de login con Google Identity Services -->
  <div id="g_id_onload"
       data-client_id="935035577743-7ds3utl0nsbat33sbt2ervnckcgeceqr.apps.googleusercontent.com" 
       data-login_uri=""
       data-auto_prompt="false"
       data-callback="handleCredentialResponse">
  </div>

  <div class="g_id_signin" data-type="standard"></div>

  <!-- Selector de carpetas -->
  <h3>Carpetas disponibles en Drive</h3>
  <select id="listaCarpetas"></select>

  <!-- Listado de documentos -->
  <h3>Documentos PDF en la carpeta</h3>
  <ul id="listaDocs"></ul>

  <!-- Formulario de registro -->
  <h3>Registrar documento en Google Sheets</h3>
  <label>Archivo seleccionado:</label>
  <input id="archivoSeleccionado" readonly><br>

  <label>Contraparte:</label>
  <input id="contraparte"><br>

  <label>CategorÃ­a:</label>
  <input id="categoria"><br>

  <label>Comentarios:</label>
  <input id="comentarios"><br>

  <button id="guardar">Guardar Registro</button>

  <script>
    // ðŸ”‘ CONFIGURACIÃ“N
    const SHEET_ID =  "1D8QeHDNR2bp8Ylfft-AyGTjyNbk_LLF8b6_LwvqBMqY"; //"TU_SHEET_ID"; "TU_SHEET_ID";
    const SCOPES = "https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/spreadsheets";

    let token = null;

    // Callback de login GIS
    function handleCredentialResponse(response) {
      token = response.credential; // JWT
      initGapiClient();
    }

    // Inicializar gapi client con token
    function initGapiClient() {
      gapi.load("client", async () => {
        await gapi.client.init({
          apiKey: "", // opcional si solo usas OAuth
          discoveryDocs: [
            "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",
            "https://sheets.googleapis.com/$discovery/rest?version=v4"
          ]
        });
        gapi.client.setToken({access_token: token});
        listarCarpetas();
      });
    }

    // Listar carpetas del usuario
    function listarCarpetas() {
      gapi.client.drive.files.list({
        q: "mimeType='application/vnd.google-apps.folder' and trashed=false",
        fields: "files(id, name)",
        pageSize: 20
      }).then(response => {
        const carpetas = response.result.files;
        const select = document.getElementById("listaCarpetas");
        select.innerHTML = "";
        carpetas.forEach(c => {
          let opt = document.createElement("option");
          opt.value = c.id;
          opt.textContent = c.name;
          select.appendChild(opt);
        });

        if (carpetas.length > 0) listarArchivos(carpetas[0].id);

        select.onchange = () => listarArchivos(select.value);
      });
    }

    // Listar archivos PDF de la carpeta seleccionada
    function listarArchivos(carpetaId) {
      gapi.client.drive.files.list({
        q: `'${carpetaId}' in parents and mimeType='application/pdf' and trashed=false`,
        fields: "files(id, name, webViewLink)",
        pageSize: 50
      }).then(response => {
        const files = response.result.files;
        const lista = document.getElementById("listaDocs");
        lista.innerHTML = "";
        if (files && files.length > 0) {
          files.forEach(f => {
            const li = document.createElement("li");
            li.innerHTML = `<a>${f.name}</a>`;
            li.querySelector("a").onclick = () => {
              document.getElementById("archivoSeleccionado").value = f.name;
              document.getElementById("archivoSeleccionado").dataset.fileId = f.id;
              window.open(f.webViewLink, "_blank");
            };
            lista.appendChild(li);
          });
        } else {
          lista.innerHTML = "<li>No hay archivos PDF en esta carpeta.</li>";
        }
      });
    }

    // Guardar registro en Google Sheets
    document.getElementById("guardar").addEventListener("click", () => {
      const archivo = document.getElementById("archivoSeleccionado").value;
      const fileId = document.getElementById("archivoSeleccionado").dataset.fileId || "";
      const contraparte = document.getElementById("contraparte").value;
      const categoria = document.getElementById("categoria").value;
      const comentarios = document.getElementById("comentarios").value;

      if (!archivo) {
        alert("Primero selecciona un archivo.");
        return;
      }

      const valores = [
        new Date().toISOString(),
        archivo,
        fileId,
        contraparte,
        categoria,
        comentarios
      ];

      gapi.client.sheets.spreadsheets.values.append({
        spreadsheetId: SHEET_ID,
        range: "A:F",
        valueInputOption: "RAW",
        insertDataOption: "INSERT_ROWS",
        resource: { values: [valores] }
      }).then(() => {
        alert("Registro guardado en Sheets!");
        document.getElementById("archivoSeleccionado").value = "";
        document.getElementById("contraparte").value = "";
        document.getElementById("categoria").value = "";
        document.getElementById("comentarios").value = "";
      });
    });
  </script>
</body>
</html>
